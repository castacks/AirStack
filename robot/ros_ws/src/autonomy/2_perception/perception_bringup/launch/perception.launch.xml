<!-- PERCEPTION -->
<launch>


    <!-- State and depth estimation -->
    <!-- Camera is in optical frame. This is Z-forward, x right, y down.  -->
     <!-- the tf rotation applies in argument order (yaw first, then pitch, then roll) -->
    <node
        pkg="tf2_ros"
        exec="static_transform_publisher"
        name="static_transform_publisher"
        args="--x 0 --y 0 --z 0 --yaw 1.5708 --pitch -1.5708 --roll 3.14159 --frame-id front_stereo_left_camera_optical_frame --child-frame-id macvo_ned" />

    <?ignore
    <node pkg="macvo" exec="macvo" namespace="macvo">
        <param name="camera_config" value="$(find-pkg-share macvo)/config/model_config.yaml" />
        <!-- override -->
        <param from="$(find-pkg-share macvo)/config/interface_config.yaml" />
        <remap from="left/image_rect"
            to="/$(env ROBOT_NAME)/sensors/front_stereo/left/image_rect" />
        <remap from="right/image_rect"
            to="/$(env ROBOT_NAME)/sensors/front_stereo/right/image_rect" />
        <remap from="sensors/get_camera_params"
            to="/$(env ROBOT_NAME)/sensors/get_camera_params" />
    </node>
   ?>
    
    <!-- Depth Estimation -->
    <!-- Disparity -->
    <node pkg="stereo_image_proc" exec="disparity_node"
        namespace="stereo_image_proc">
        <remap from="left/image_rect" to="/$(env ROBOT_NAME)/sensors/front_stereo/left/image_rect" />
        <remap from="left/camera_info" to="/$(env ROBOT_NAME)/sensors/front_stereo/left/camera_info" />
        <remap from="right/image_rect" to="/$(env ROBOT_NAME)/sensors/front_stereo/right/image_rect" />
        <remap from="right/camera_info"
               to="/$(env ROBOT_NAME)/sensors/front_stereo/right/camera_info" />

	<remap from="/$(env ROBOT_NAME)/stereo_image_proc/disparity" to="/$(env ROBOT_NAME)/sensors/front_stereo/disparity" />
    </node>

    <!-- Visualizer -->
    <!--
    <node pkg="image_view" exec="disparity_view"
        namespace="disparity_view">
        <remap from="image" to="/$(env ROBOT_NAME)/sensors/front_stereo/disparity" />
    </node>
    -->
    <node
	pkg="stereo_image_proc"
	exec="point_cloud_node"
	name="stereo_pointcloud"
	output="screen">
      
      <remap from="left/image_rect_color" to="/$(env ROBOT_NAME)/sensors/front_stereo/left/image_rect"/>
      <remap from="left/camera_info"     to="/$(env ROBOT_NAME)/sensors/front_stereo/left/camera_info"/>
      <remap from="right/camera_info"     to="/$(env ROBOT_NAME)/sensors/front_stereo/right/camera_info"/>
      <remap from="disparity"            to="/$(env ROBOT_NAME)/sensors/front_stereo/disparity"/>
      <remap from="points2"              to="/$(env ROBOT_NAME)/sensors/front_stereo/pointcloud"/>
    </node>

</launch>
